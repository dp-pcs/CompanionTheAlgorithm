# The Algorithm - iOS Companion App

A sophisticated SwiftUI iOS application that provides native mobile access to [The Algorithm](https://thealgorithm.live) platform with dual authentication flow for OAuth and X.com session management.

## ğŸ“± Overview

This iOS companion app enables users to:
- **Authenticate** with The Algorithm backend via OAuth 2.0 + PKCE
- **Connect X.com** account and extract session cookies securely
- **View feeds** from monitored users
- **Manage posting queues** and scheduled content
- **Edit drafts** generated by The Algorithm's AI
- **Monitor users** and manage lists
- **Check system status** and settings

## âœ¨ Features

### Authentication & Security
- âœ… **OAuth 2.0 with PKCE** - Secure mobile authentication without client secrets
- âœ… **iOS Keychain Storage** - Secure storage of tokens and session cookies
- âœ… **WKWebView Integration** - Safe X.com authentication with cookie extraction
- âœ… **Automatic State Management** - Seamless session persistence across app launches

### Core Functionality
- âœ… **Feed View** - Browse posts from monitored users with real-time updates
- âœ… **Posting Queue** - View and manage scheduled posts and their status
- âœ… **Draft Replies** - Review and edit AI-generated tweet replies
- âœ… **User Management** - Add/remove monitored X.com users
- âœ… **Settings & Status** - Monitor API health and system configuration

### UI/UX
- âœ… **SwiftUI Architecture** - Modern, declarative UI with native iOS feel
- âœ… **Tab-Based Navigation** - 6 main sections with intuitive organization
- âœ… **Progressive Disclosure** - Step-by-step authentication flow
- âœ… **Error Handling** - User-friendly error messages and recovery options
- âœ… **Loading States** - Clear feedback during network operations

## ğŸ—ï¸ Architecture

### Project Structure

```
mobile_thealgorithm/
â”œâ”€â”€ mobile_thealgorithm.xcodeproj/      # Xcode project
â”œâ”€â”€ mobile_thealgorithm-Info.plist      # App configuration
â””â”€â”€ mobile_thealgorithm/
    â”œâ”€â”€ The_Algorithm___CompanionApp.swift   # App entry point
    â”œâ”€â”€ ContentView.swift                     # Main view with tab navigation
    â”œâ”€â”€ AuthenticationViewModel.swift         # Authentication state management
    â”œâ”€â”€ FeedView.swift & FeedViewModel.swift  # Feed browsing
    â”œâ”€â”€ PostingQueueView.swift & ViewModel    # Queue management
    â”œâ”€â”€ DraftsView.swift & ViewModel          # Draft editing
    â”œâ”€â”€ MonitoredUsersView.swift & ViewModel  # User management
    â”œâ”€â”€ SettingsStatusView.swift & ViewModel  # Settings & status
    â”œâ”€â”€ TwitterCookieApp/
    â”‚   â”œâ”€â”€ AuthenticationManager.swift       # OAuth & X.com auth (UIKit)
    â”‚   â”œâ”€â”€ CookieManager.swift              # Cookie storage & validation
    â”‚   â””â”€â”€ APIClient.swift                  # Backend API communication
    â””â”€â”€ Assets.xcassets/                     # App icons and images
```

### Technology Stack

| Component | Technology |
|-----------|------------|
| Language | Swift 5.0+ |
| UI Framework | SwiftUI |
| Auth Bridge | UIKit (WKWebView for X.com) |
| Networking | URLSession |
| Storage | iOS Keychain |
| Architecture | MVVM Pattern |

## ğŸš€ Getting Started

### Prerequisites

- **macOS** 13.0 (Ventura) or later
- **Xcode** 15.0 or later
- **iOS** 17.0+ (deployment target)
- **The Algorithm Backend** running at `https://thealgorithm.live`

### Configuration

The app is pre-configured with:

```swift
// AuthenticationManager.swift (lines 10-13)
private let oauthURL = "https://thealgorithm.live/oauth/authorize"
private let tokenURL = "https://thealgorithm.live/oauth/token"
private let redirectURI = "thealgorithm://oauth/callback"
private let clientID = "ios_app_081b7e3ab09f49b2"  // â† Registered client ID
```

```swift
// APIClient.swift (line 336)
private let baseURL = URL(string: "https://thealgorithm.live")!
```

**URL Scheme:** Already configured in `Info.plist` as `thealgorithm://`

### Backend Requirements

Your backend must implement these endpoints:

#### OAuth Endpoints
- `GET /oauth/authorize` - OAuth authorization (step 1)
- `POST /oauth/token` - Token exchange with PKCE verification (step 2)

#### iOS-Specific Endpoints
- `POST /api/store-cookies` - Store X.com session cookies
- `POST /api/send-message` - Post tweets via stored session
- `GET /api/health` - Health check

#### Additional Endpoints (for full functionality)
- `GET /api/v1/users/monitoring/status` - Get monitoring status and feed
- `POST /api/v1/posts/fetch-timeline` - Fetch X.com timeline
- `GET /api/v1/posting-jobs` - Get posting queue status
- `GET /api/v1/replies` - Get draft replies
- `GET /api/v1/users/me/monitored` - Get monitored users list
- `GET /api/v1/settings/status` - Get settings and system status

### Installation

1. **Clone the repository:**
   ```bash
   git clone git@github.com:dp-pcs/mobile_thealgorithm.git
   cd mobile_thealgorithm
   ```

2. **Open in Xcode:**
   ```bash
   open mobile_thealgorithm.xcodeproj
   ```

3. **Select target device** (Simulator or physical iPhone)

4. **Build and run** (âŒ˜ + R)

### First Run Setup

1. **Launch the app** - You'll see the authentication flow
2. **Tap "Authenticate with The Algorithm"** - Opens OAuth flow in Safari
3. **Log in** with your The Algorithm account
4. **Return to app** - OAuth token stored securely
5. **Tap "Authenticate with X.com"** - Opens WKWebView
6. **Log in to X.com** - Cookies extracted automatically
7. **Done!** - Full access to all features unlocked

## ğŸ”’ Security

### Implemented Security Features

- âœ… **PKCE (Proof Key for Code Exchange)** - RFC 7636 compliant
- âœ… **iOS Keychain Storage** - Secure token and cookie storage
- âœ… **CSRF Protection** - State parameter in OAuth flow
- âœ… **HTTPS Only** - All network requests use TLS
- âœ… **Secure Cookie Extraction** - WKWebView with proper isolation
- âœ… **Token Expiration Handling** - Automatic re-authentication prompts

### Security Best Practices

```swift
// Tokens stored in iOS Keychain (not UserDefaults)
KeychainHelper.save(token, service: "TheAlgorithm", account: "oauth_token")

// PKCE verifier generated with SecRandomCopyBytes
var buffer = [UInt8](repeating: 0, count: 32)
SecRandomCopyBytes(kSecRandomDefault, buffer.count, &buffer)

// All API calls include Bearer token
request.setValue("Bearer \(token)", forHTTPHeaderField: "Authorization")
```

## ğŸ“Š API Integration

### Authentication Flow

```
1. User taps "Authenticate with The Algorithm"
   â†“
2. App generates PKCE code_verifier and code_challenge
   â†“
3. Safari opens: /oauth/authorize?client_id=...&code_challenge=...
   â†“
4. User logs in on backend
   â†“
5. Backend redirects: thealgorithm://oauth/callback?code=xxx
   â†“
6. App captures code and exchanges for token
   POST /oauth/token with code_verifier
   â†“
7. Store access_token in Keychain
   â†“
8. User taps "Authenticate with X.com"
   â†“
9. WKWebView loads X.com/login
   â†“
10. User enters X.com credentials
    â†“
11. App detects successful login (x.com/home)
    â†“
12. Extract cookies: auth_token, ct0, auth_multi, twid
    â†“
13. POST /api/store-cookies with cookies array
    â†“
14. âœ… Authenticated! Full access enabled
```

### Making API Calls

```swift
// Example: Fetch monitoring status and feed
func fetchMonitoringStatus(completion: @escaping (Result<MonitoringStatus, Error>) -> Void) {
    performRequest(path: "/api/v1/users/monitoring/status", completion: completion)
}

// Automatic Bearer token inclusion
private func performRequest<T: Decodable>(
    path: String,
    method: String = "GET",
    completion: @escaping (Result<T, Error>) -> Void
) {
    // Token automatically retrieved from Keychain
    guard let token = authManager.getOAuthToken() else {
        completion(.failure(APIClientError.missingAuthToken))
        return
    }
    
    request.setValue("Bearer \(token)", forHTTPHeaderField: "Authorization")
    // ... make request
}
```

## ğŸ§ª Testing

### Manual Testing Checklist

- [ ] OAuth authentication completes successfully
- [ ] Token persists across app restarts
- [ ] X.com login works in WebView
- [ ] Cookies extracted after X.com login
- [ ] Feed loads posts from backend
- [ ] Posting queue displays jobs
- [ ] Draft replies appear correctly
- [ ] Monitored users list loads
- [ ] Settings status reflects backend state
- [ ] API health check works
- [ ] Clear data removes all auth
- [ ] Re-authentication flow works

### Backend Integration Testing

```bash
# 1. Check backend health
curl https://thealgorithm.live/api/health

# Expected: {"status": "healthy", "version": "1.0.0", ...}

# 2. Verify OAuth client registered
# From backend repo:
cd thealgorithm
python scripts/register_ios_oauth_client.py

# Should show client_id: ios_app_081b7e3ab09f49b2

# 3. Test OAuth flow
# Use iOS app to authenticate, monitor backend logs
```

## ğŸ› Troubleshooting

### OAuth Issues

**Problem:** "Invalid client_id"  
**Solution:** Ensure backend has registered the iOS OAuth client

**Problem:** "PKCE verification failed"  
**Solution:** Check that code_verifier and code_challenge are properly generated

**Problem:** OAuth redirect not working  
**Solution:** Verify `thealgorithm://` URL scheme is in Info.plist

### X.com Cookie Issues

**Problem:** No cookies extracted  
**Solution:** Ensure user completes full login (reaches x.com/home)

**Problem:** Cookies expired  
**Solution:** User needs to re-authenticate with X.com

### API Issues

**Problem:** "No OAuth token available"  
**Solution:** Complete OAuth authentication first

**Problem:** API requests fail with 401  
**Solution:** Token may be expired, clear data and re-authenticate

**Problem:** API requests fail with network error  
**Solution:** Check backend is running at https://thealgorithm.live

## ğŸ“š Documentation

### In-App Documentation
- `CONFIGURATION_SUMMARY.md` - Configuration details
- `GETTING_STARTED.md` - Quick start guide
- `INTEGRATION_CHECKLIST.md` - Integration verification
- `PROJECT_SUMMARY.md` - Technical overview
- `QUICK_START.md` - Rapid setup guide
- `REQUIREMENTS.md` - System requirements
- `SETUP_GUIDE.md` - Detailed setup
- `WHATS_NEXT.md` - Future enhancements

### Backend Documentation
See `mobile app/` folder for backend integration documentation:
- `IOS_TEAM_HANDOFF.md` - Complete handoff document
- `BACKEND_INTEGRATION_COMPLETE.md` - Backend implementation status
- `START_HERE.md` - Entry point for developers

## ğŸ”— Related Repositories

- **Backend:** [thealgorithm](https://github.com/dp-pcs/thealgorithm)
- **iOS App:** [mobile_thealgorithm](https://github.com/dp-pcs/mobile_thealgorithm) (this repo)

## ğŸš€ Deployment

### TestFlight Beta

1. **Archive the app** in Xcode (Product â†’ Archive)
2. **Upload to App Store Connect**
3. **Create beta test group**
4. **Invite testers**
5. **TestFlight link will be generated**

### App Store Submission

1. **Update version number** in Xcode
2. **Archive and upload**
3. **Complete App Store listing:**
   - App name: "The Algorithm Companion"
   - Category: Social Networking
   - Screenshots (required)
   - Privacy Policy URL
   - Description
4. **Submit for review**

## ğŸ“ˆ Roadmap

### Current Features (v1.0)
- âœ… OAuth 2.0 + PKCE authentication
- âœ… X.com cookie extraction
- âœ… Feed browsing
- âœ… Posting queue management
- âœ… Draft reply editing
- âœ… User monitoring
- âœ… Settings & status

### Planned Features (v1.1+)
- ğŸ“‹ Push notifications for new posts
- ğŸ“‹ In-app tweet composing
- ğŸ“‹ Multiple account support
- ğŸ“‹ Offline caching
- ğŸ“‹ Advanced filtering
- ğŸ“‹ Analytics dashboard

## ğŸ¤ Contributing

This is a private repository for The Algorithm project. For questions or issues:

1. Create an issue in this repository
2. Tag with appropriate label (`bug`, `feature`, `question`)
3. Include device info, iOS version, and logs if applicable

## ğŸ“„ License

Proprietary - All rights reserved by The Algorithm / Proctor Consulting Services

## ğŸ“ Support

**Technical Issues:**
- GitHub Issues: [mobile_thealgorithm/issues](https://github.com/dp-pcs/mobile_thealgorithm/issues)
- Label: `mobile-app`

**Backend Integration:**
- See `mobile app/IOS_TEAM_HANDOFF.md`
- Backend repo: [thealgorithm](https://github.com/dp-pcs/thealgorithm)

---

**Built with â¤ï¸ by the The Algorithm Team**

Last Updated: October 31, 2025

